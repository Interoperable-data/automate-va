<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>SHACL Form Tester</title>
    <script src="https://cdn.jsdelivr.net/npm/@ulb-darmstadt/shacl-form/dist/form-default.js" type="module"></script>
    <script src="https://unpkg.com/htmx.org@1.9.12"></script>
    <style>
        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: sans-serif;
        }

        body {
            height: 100vh;
        }

        #container {
            display: flex;
            flex-direction: row;
            height: 100vh;
            width: 100vw;
        }

        #form-panel {
            flex: 3 1 0;
            min-width: 0;
            padding: 1em 1em 1em 1em;
            box-sizing: border-box;
            border-right: 1px solid #ccc;
            background: #fafbfc;
        }

        #rdf-panel {
            flex: 2 1 0;
            min-width: 0;
            padding: 1em;
            box-sizing: border-box;
            background: #f5f5f5;
            overflow-x: auto;
            overflow-y: auto;
        }

        #rdf-panel pre {
            white-space: pre-wrap;
            word-break: break-all;
            font-size: 0.95em;
            background: #f0f0f0;
            border: 1px solid #ddd;
            padding: 0.5em;
            border-radius: 4px;
            height: 90vh;
            margin: 0;
        }

        #topbar {
            width: 100vw;
            background: #eaeaea;
            padding: 0.5em 1em;
            box-sizing: border-box;
            border-bottom: 1px solid #ccc;
            display: flex;
            align-items: center;
            gap: 1em;
        }

        select {
            font-size: 1em;
            padding: 0.2em 0.5em;
        }

        label {
            font-weight: bold;
        }
    </style>
</head>

<body>
    <div id="topbar">
        <label for="shape-select">Select SHACL shape:</label>
        <select id="shape-select"
            hx-trigger="change"
            hx-on="change: updateShaclForm()">
            <option value="form-shapes/ecm-certificate-0.0.0.3.shacl">ECM Certificate</option>
            <option value="form-shapes/ecm-attestation-0.0.0.1.shacl">ECM Attestation</option>
            <option value="form-shapes/mfct-certificate-0.0.0.1.shacl">MFCT Certificate</option>
            <option value="form-shapes/va-c2t-evidence-full-0.0.0.1.shacl">VA C2T Evidence Full</option>
            <option value="form-shapes/va-c2t-admin-0.0.0.3.shacl">VA C2T Admin v0.0.0.3</option>
        </select>
        <span style="color:#888;font-size:0.95em;">(from /TTL/form-shapes/)</span>
    </div>
    <div id="container">
        <div id="form-panel">
            <shacl-form id="shaclform" data-shapes-url="form-shapes/ecm-certificate-0.0.0.3.shacl" data-collapse="open"
                data-submit-button="Submit" data-language="en" style="width:100%;"></shacl-form>
        </div>
        <div id="rdf-panel">
            <h3>Generated RDF (Turtle)</h3>
            <pre id="output">(Fill the form to see RDF output)</pre>
        </div>
    </div>
    <script>
        function updateShaclForm() {
            const select = document.getElementById('shape-select');
            const form = document.getElementById('shaclform');
            const output = document.getElementById('output');
            // Replace only the shacl-form element
            const newForm = document.createElement('shacl-form');
            newForm.setAttribute('id', 'shaclform');
            newForm.setAttribute('data-shapes-url', select.value);
            newForm.setAttribute('data-collapse', 'open');
            newForm.setAttribute('data-submit-button', 'Submit');
            newForm.setAttribute('data-language', 'en');
            newForm.style.width = '100%';
            form.parentNode.replaceChild(newForm, form);
            output.textContent = '(Fill the form to see RDF output)';
            newForm.addEventListener('change', function(event) {
                if (event.detail?.valid) {
                    output.textContent = event.target.serialize();
                }
            });
        }
        // Initial form event binding
        document.getElementById('shaclform').addEventListener('change', function(event) {
            const output = document.getElementById('output');
            if (event.detail?.valid) {
                output.textContent = event.target.serialize();
            }
        });
    </script>
</body>

</html>