@base <http://data.europa.eu/949/> .
@prefix era: <http://data.europa.eu/949/> .

# General
@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix sh:   <http://www.w3.org/ns/shacl#> .
@prefix skos: <http://www.w3.org/2004/02/skos/core#> .
@prefix vpa: <http://w3id.org/vpa#> .

# Domain-specific
@prefix eralex: <http://data.europa.eu/949/requirements/legislations/> .
@prefix eralex-pava: <http://data.europa.eu/949/requirements/legislations/pava/> .

# Relevant SKOS Concept Schemes
@prefix era-va-authcase: <http://data.europa.eu/949/concepts/va-authcases/> .

eralex-pava:AnnexI-7 a skos:Concept , sh:NodeShape ;
    skos:inScheme eralex:AnnexIConceptScheme ;
    skos:prefLabel "(I) 7. Current vehicle type authorisation holder"@en ;
    skos:definition "Current vehicle type authorisation holder (if not first authorisation)."@en ;
    sh:targetClass era:VehicleTypeAuthorisationCase ;
    sh:xone (
        [
            a sh:NodeShape ;
            sh:name "No holder for new authorisation"@en ;
            sh:property [
                sh:path vpa:permissionType ;
                sh:hasValue era-va-authcase:NEW ;
                sh:name "Permission type is NEW"@en ;
            ] ;
            sh:property [
                sh:path ( vpa:constitutes vpa:requestFor era:vehicleTypeAuthorisationHolder era:roleOf ) ;
                sh:maxCount 0 ;
                sh:name "No holder organisation present"@en ;
                sh:message "If permissionType is 'NEW', there must not be a holder organisation yet."@en ;
                sh:severity sh:Violation
            ]
        ]
        [
            a sh:NodeShape ;
            sh:name "Current authorisation holder organisation"@en ;
            sh:property [
                sh:path vpa:permissionType ;
                sh:in ( era-va-authcase:FA era-va-authcase:EXT era-va-authcase:RENEW era-va-authcase:C2T ) ;
                sh:name "Permission type is not NEW"@en ;
            ] ;
            sh:property [
                sh:path ( vpa:constitutes vpa:requestFor era:vehicleTypeAuthorisationHolder era:roleOf ) ;
                sh:minCount 1 ;
                sh:name "Holder organisation present"@en ;
                sh:message "If permissionType is not 'NEW', VehicleTypeAuthorisationCase must link to a VehicleTypeAuthorisation with a holder organisation."@en ;
                sh:severity sh:Violation
            ]
        ]
    ) ;
    sh:message "An Authorisation contains a holder organisation if and only if the permission type is not 'NEW'."@en ;
    dcterms:source <https://eur-lex.europa.eu/legal-content/EN/TXT/?uri=CELEX%3A02018R0545-20200616#anx_I> .
