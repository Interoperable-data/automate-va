@base <http://data.europa.eu/949/> .
@prefix : <http://data.europa.eu/949/> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix era: <http://data.europa.eu/949/> .
@prefix foaf: <http://xmlns.com/foaf/0.1/> .
@prefix org: <http://www.w3.org/ns/org#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix skos: <http://www.w3.org/2004/02/skos/core#> .
@prefix time: <http://www.w3.org/2006/time#> .
@prefix unit: <http://qudt.org/vocab/unit/> .
@prefix vpa: <http://w3id.org/vpa/> .
@prefix vs: <http://www.w3.org/2003/06/sw-vocab-status/ns#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix xml: <http://www.w3.org/XML/1998/namespace> .

# For inclusion in the ERA ontology, after review
# Do not use currently
:CLD a 
    owl:Class , sh:NodeShape ;
    rdfs:subClassOf :TimeBoundDocument, vpa:EvidenceDocument ;
    dcterms:created "2024-10-25"^^xsd:date ;
    # dcterms:modified "_RESERVED_"^^xsd:date ;

    ## definitions ----------
    rdfs:comment """Certification Level Documents (CLD) issued by NoBos are:
    • EC Certificates
    • QMS-Approvals
    and whether these are Intermediate Statements of Verification (ISVs).

    The EU legislative documents 768/2008/EC, (EU) 2016/797, (EU) 2019/250 and 2010/713/EU establish a number of requirements on the content of CLDs."""@en ;
    rdfs:isDefinedBy <http://data.europa.eu/949/> ;
    rdfs:seeAlso "https://nb-rail.eu/official-documents?_hash=sdZw5f9knrCRlgtc8tjzq263IkcdQhDo05f6n%2FKVqUA%3D&ctx=a%3A1%3A%7Bs%3A2%3A%22id%22%3Bi%3A154%3B%7D&p=documents%2FRFU%2FAll+subsystems%2FRFU-STR-001+Content+of+EC+Certificates.pdf";
    rdfs:label "Certification Level Documents"@en ;
    dcterms:source <http://data.europa.eu/eli/dec/2008/768(1)/oj>, 
        <http://data.europa.eu/eli/dir/2016/797/2020-05-28>,
        <http://data.europa.eu/eli/reg_impl/2019/250/2020-06-16>,
        <http://data.europa.eu/eli/dec/2010/713/oj> ;

    ## shape ----------
    # The following `era:` Classes must conform to the shape of a CLD.
    # TODO: DeBo, AsBo certificates can conform to this shape as well.
    sh:targetClass era:ECCertificate, era:QMSApproval  ;  # era:IntermediateStatement is not a separate class
    sh:property [
        a sh:PropertyShape ;
        sh:path dcterms:identifier ;
        sh:datatype xsd:string ;
        sh:pattern ""; # todo, see VA-Inspector
        sh:nodeKind sh:Literal ;
        sh:description "The CLD ID, as defined in RFU-STR-001.";
        skos:definition """The combination of the CLD ID and the Version counter is the unique ‘identification number’ ensuring traceability of the CLD in accordance with (EU) 2019/250."""@en ;
        sh:minCount 1;
        sh:maxCount 1
    ];
    sh:property [
        a sh:PropertyShape ;
        sh:path vpa:versionNumber ;
        sh:datatype xsd:number ;
        sh:nodeKind sh:Literal ;
        sh:description "The Version Counter of the CLD, as defined in RFU-STR-001.";
        skos:definition """The combination of the CLD ID and the Version counter is the unique ‘identification number’ ensuring traceability of the CLD in accordance with (EU) 2019/250.

        CLD's carry version number 0, if no `/Vxx` in the `identification number` is present. There are no CLD's with /V00 (allowed)."""@en ;
        sh:minCount 1;
        sh:maxCount 1
    ];
    sh:property [
        a sh:PropertyShape ;
        sh:path rdfs:comment ;
        sh:datatype xsd:string ;
        sh:nodeKind sh:Literal ;
        sh:description "Scope of Certification by reference to Object of Assessment (un-ambiguous denomination)"@en; 
        skos:note "The Object of Assessment of the CLD, as defined in RFU-STR-001.";
        skos:definition """Scope of Certification by reference to Object of Assessment: Identified by industry-typical and un-ambiguous denomination. This may include a reference to a separate attached document which provides a more detailed 
        definition (e.g. a Product Type Drawing, the NoBo-File/Documentation, the EC Assessment Report.) [R4,R12,R28]"""@en ;
        sh:minCount 1;
        sh:maxCount 1
    ];
    sh:property [
        a sh:PropertyShape ;
        sh:path rdfs:seeAlso ;
        sh:datatype xsd:anyURI ;
        sh:nodeKind sh:Literal ;
        sh:description "The ERADIS URL of the CLD, if available under `http://eradis.era.europa.eu`.";
        sh:maxCount 1
    ];
    sh:property [
        a sh:PropertyShape ;
        sh:path dcterms:subject ;
        sh:description "Scope of Certification by reference to Object of Assessment (links to EURLEX)"@en;
        skos:note "The examined subsystem and if applicable, interoperability constituent, expressed as a URI to the legal reference in which these are uniquely defined.";
        skos:definition """Scope of Certification by reference to Object of Assessment: Designation of the certified Interoperability Constituent/ Subsystem Type(s) and variant(s)/versions(s)
        included in the certification. Detailed further using `rdfs:comment`"""@en ;
        sh:minCount 1 ;
        sh:nodeKind sh:IRI ; 
        sh:class vpa:Requirement
    ];
    sh:property [
        a sh:PropertyShape ;
        sh:path dcterms:type ;
        sh:description "SKOS Concept indicating what type of CLD is represented, as in RDU-STR-001 C) (page 8)"@en ;
        sh:nodeKind sh:IRI ;
        skos:definition """From RFU-STR-001, issue 20.
Rail Notified Bodies may issue CLDs of the following types:
1 - EC Type Examination Certificate (B, CB, SB)
2 - EC Design Examination Certificate (CH1, H2, SH1, SH2)
4 - Quality Management System Approval (CD, CH, CH1, D, SD, H1, H2, SH1, SH2)
5 - EC Certificate of Conformity (A1, CA1, CA2, CF, F)
6 - EC Certificate of Verification (SD, SF, SG, SH1, SH2)
7 - EC Certificate of Suitability for Use (CV, V)
8.1 - Intermediate Statement of Verification – EC Type Examination (SB)
8.2 - Intermediate Statement of Verification – EC Design Examination (SH1, SH2)
8.4 - Intermediate Statement of Verification – Quality Management System Approval (SD, SH1, SH2)
8.6 - Intermediate Statement of Verification - EC Certificate of Verification (SD, SF, SG, SH1, SH2)
        """@en ;
        sh:maxCount 1 ;
        
    ] ;
    sh:property [
        a sh:PropertyShape ;
        sh:path dcterms:coverage ;
        sh:description "Scope of Certification by reference to Assessment Requirements (links to EURLEX)"@en;
        skos:note "The examined subsystem and if applicable, interoperability constituent, expressed as a URI to the legal reference in which these are uniquely defined.";
        skos:definition """Scope of Certification by reference to Assessment Requirements: TSls and their identification number to which conformity was assessed, including any Amendments. 

        Format as defined by ELI: 
        <http://data.europa.eu/eli/reg/2014/1304/oj> for the unamended legislation;
        <http://data.europa.eu/eli/reg/2014/1304/2023-09-28> for the amendment <http://data.europa.eu/eli/reg_impl/2023/1694/oj>, as published on 28/09/2023.;
        """@en ;
        sh:minCount 1 ;
        sh:nodeKind sh:IRI ; 
        sh:class vpa:Requirement
    ];
    #sh:property [
    #    a sh:PropertyShape ;
    #    sh:path vpa:checked ; ERROR, as this is a property of vpa:Compliance
    #    sh:description "Scope of Certification by reference to Assessment Requirements (TSI specific verification)"@en;
    #    skos:definition """The detailed assessment references must be the URI of SKOS Concepts of the ERA RINF vocabulary.    
    #    (Mandatory) For TSI CCS also the set(s) of specifications of TSI CCS Appendix A, including the TSI CCS from which the set is taken (e. g. set of specifications #2 from
    #    TSI CCS (EU) 2016/919 last amended by (EU) 2020/387) and (only if part train protection is assessed) the ETCS system version.
    #    (Optional) For other TSI's"""@en ;
    #    sh:nodeKind sh:IRI ; 
    #    sh:class skos:ConceptScheme # ETCSMandatorySpecificationsSet & (exists) ETCSMVersions
    #];
    sh:property [
        a sh:PropertyShape ;
        sh:path dcterms:creator ;
        sh:description "The assesment body having issued the CLD, expressed as a URI to the organisation which represents this body uniquely.";
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:nodeKind sh:IRI ; 
        sh:class :EvidenceProvidingOrganisation 
    ];
    sh:property [
        a sh:PropertyShape ;
        sh:path dcterms:audience ;
        sh:description "The organisation using the CLD as Applicant, expressed as a URI to the organisation which represents this body uniquely.";
        skos:definition """Name and address of Applicant (or of his authorized representative established within the Community.) [R9] """@en;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:nodeKind sh:IRI ; 
        sh:class :ApplyingOrganisation 
    ];
    sh:property [
        a sh:PropertyShape ;
        sh:path dcterms:contributor ;
        sh:description "The manufacturer involved in the assessment, expressed as a URI to the organisation which represents this body uniquely.";
        skos:definition """Name and address of the Manufacturer (or of his authorized representative established within the Community. 
        If Applicant and Manufacturer are the same entity, reuse the IRI from the Applicant.) [R1,R8,R33]"""@en;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:nodeKind sh:IRI ; 
        sh:class :ApplyingOrganisation 
    ];
    sh:property [
        a sh:PropertyShape ;
        sh:path dcterms:spatial ;
        sh:description "The `org:Site` to which this CLD is linked, mostly a specific Production site audited in a QMSA.";
        skos:definition """6. Scope of Certification by reference to Location of manufacturer (only if relevant (e.g. for all QMS approvals), only if different from address of Manufacturer. 
        May also be a list of several locations.) [R3.a,R33]"""@en;
        sh:nodeKind sh:IRI ; 
        sh:class org:Site 
    ];
.

# Section 2 of a vehicle type should be resolved through Restriction and Compliance resources.
# Conformity of a VehicleType to TSI's
:TSIConformity a 
    owl:Class , sh:NodeShape , vpa:Restriction ;
    dcterms:created "2024-10-25"^^xsd:date ;
    # dcterms:modified "_RESERVED_"^^xsd:date ;

    ## definitions ----------
    rdfs:label "Vehicle Type Certificate: Conformity with TSI"@en;
    rdfs:seeAlso "https://eur-lex.europa.eu/eli/dec_impl/2011/665/2023-09-08#anx_II" ;
    dcterms:source <http://data.europa.eu/eli/dec_impl/2011/665/2023-09-08> ;

    ## Properties -----------
    sh:property [
        a sh:PropertyShape ;
        sh:path vpa:regarding ;
        sh:nodeKind sh:IRI ;
        sh:class era:Requirement ; # Use an exact link to the vehicle-related TSI examined /ERALEX
        sh:description "The TSI for which conformity was checked in this VehicleType. Selection from a predefined list of vehicle related TSIs (both in force and those that were previously in force) (multiple selection possible)"@en
    ].

:TSIComplianceCheck  a 
    owl:Class , sh:NodeShape ;
    rdfs:subClassOf vpa:Compliance ;
    dcterms:created "2024-10-25"^^xsd:date ;
    # dcterms:modified "_RESERVED_"^^xsd:date ;

    ## definitions ----------
    rdfs:label "Vehicle Type Certificate: Conformity with TSI - compliance check"@en;
    rdfs:seeAlso "https://eur-lex.europa.eu/eli/dec_impl/2011/665/2023-09-08#anx_II" ;
    dcterms:source <http://data.europa.eu/eli/dec_impl/2011/665/2023-09-08> ;

    ## properties
    sh:property [
        a sh:PropertyShape ;
        sh:inversePath vpa:checked ;
        sh:class :ECCertificate ;
        era:eratvIndex "2.2" ;
        sh:description  "The certificate, to be mentioned under 2.2 of the VehicleType, which examined Sections and Specific Cases, and their conclusion."@en , 
                        "EC certificate of verification : Reference of ‘EC type examination certificates’ (if module SB applied) and/or ‘EC design examination certificates’ (if module SH1 applied)"@en
    ];
    sh:property [
        a sh:PropertyShape ;
        sh:path era:isCompliant ; ## see vpa:isCompliant (allows only boolean)
        sh:nodeKind sh:IRI ;
        era:inSkosConceptScheme <http://data.europa.eu/949/concepts/tsi-conformities/ConformityResults> ;# to be created in ERA Vocabulary
        sh:class <http://www.w3.org/2004/02/skos/core#Concept> ; 
        sh:description "Y: Compliant, N: Non-compliant, P: Partially compliant."@en
    ];
    sh:property [
        a sh:PropertyShape ;
        sh:path era:checkedSection ;
        sh:nodeKind sh:IRI ;
        sh:or (
            [
                era:inSkosConceptScheme <http://data.europa.eu/949/concepts/tsi-conformities/TSISpecificCases> ;# to be created in ERA Vocabulary
                sh:class <http://www.w3.org/2004/02/skos/core#Concept> ; 
                sh:description "Applicable specific cases (specific cases conformity with which has been assessed)."@en ;
                era:eratvIndex "2.3"
            ]
            [
                era:inSkosConceptScheme <http://data.europa.eu/949/concepts/tsi-conformities/TSISections> ;# to be created in ERA Vocabulary
                sh:class <http://www.w3.org/2004/02/skos/core#Concept> ; 
                sh:description "Sections of TSI not complied with."@en ;
                era:eratvIndex "2.1"
                # Instances of this TSIComplianceCheck must have vpa:isCompliant "false"^^xsd:boolean
            ]
        )
    ];

    ## TODO: In some cases, the ComplianceCheck MUST be linked to a Vehicle Configuration
    sh:property [
        a sh:PropertyShape ;
        # sh:path :forConfiguration ;
        sh:nodeKind sh:IRI ;
        sh:class :VehicleTypeConfiguration ;
    ]
.
