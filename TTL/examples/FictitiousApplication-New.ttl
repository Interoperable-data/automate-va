@prefix as: <https://www.w3.org/ns/activitystreams#> .
@prefix cc: <http://creativecommons.org/ns#> .
@prefix dash: <http://datashapes.org/dash#> .
@prefix dcat: <http://www.w3.org/ns/dcat#> .
@prefix dct: <http://purl.org/dc/terms/> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix dul: <http://www.ontologydesignpatterns.org/ont/dul/DUL.owl#> .
@prefix era: <http://data.europa.eu/949/> .
@prefix era-cfg: <http://data.europa.eu/949/vehicleTypes/configurations/> .
@prefix era-cld: <http://data.europa.eu/949/evidences/clds/> .
@prefix era-cld-modules: <http://data.europa.eu/949/concepts/cld-modules/> .
@prefix era-cld-types: <http://data.europa.eu/949/concepts/cld-types/> .
@prefix era-ecd: <http://data.europa.eu/949/evidences/ecds/> .
@prefix era-ecd-types: <http://data.europa.eu/949/concepts/ecd-types/> .
@prefix era-ecm-attestations: <http://data.europa.eu/949/concepts/ecm-attestations/> .
@prefix era-ecm-maintenance-functions: <http://data.europa.eu/949/concepts/ecm-maintenance-functions/> .
@prefix era-ess-rinf: <http://data.europa.eu/949/concepts/energy-supply-systems/rinf/> .
@prefix era-etcsmanspecset: <http://data.europa.eu/949/concepts/etcs-mandatory-specifications-set/> .
@prefix era-lex-sections: <http://data.europa.eu/949/concepts/requirements/section/> .
@prefix era-noic: <http://data.europa.eu/949/concepts/noise-categories/NoiseCategories/> .
@prefix era-ntg-rinf: <http://data.europa.eu/949/concepts/nominal-track-gauges/rinf/> .
@prefix era-organisation-roles: <http://data.europa.eu/949/concepts/organisation-roles/> .
@prefix era-pava-at: <http://data.europa.eu/949/concepts/va-authassessment-types/> .
@prefix era-perm: <http://data.europa.eu/949/permissions/> .
@prefix era-permission-types: <http://data.europa.eu/949/concepts/permission-types/> .
@prefix era-sh: <http://data.europa.eu/949/shapes/> .
@prefix era-skos: <http://data.europa.eu/949/concepts/> .
@prefix era-states: <http://data.europa.eu/949/concepts/states/> .
@prefix era-va-authcase: <http://data.europa.eu/949/concepts/va-authcases/> .
@prefix era-va-trm: <http://data.europa.eu/949/concepts/va-type-registration-methods/> .
@prefix era-vehicle-types-eratv: <http://data.europa.eu/949/concepts/vehicle-types/eratv/> .
@prefix era-vr-regcase: <http://data.europa.eu/949/concepts/vr-regcases/> .
@prefix era-vtc: <http://data.europa.eu/949/concepts/vehicle-type-configurations/> .
@prefix eralex: <http://data.europa.eu/949/requirements/legislations/> .
@prefix eralex-pava: <http://data.europa.eu/949/requirements/legislations/pava/> .
@prefix erapod: <https://storage.inrupt.com/ea779a2c-b43d-4723-8b1a-aaa8990dd576/data/eradis/> .
@prefix eratv: <http://data.europa.eu/949/vehicleTypes/> .
@prefix erava: <http://data.europa.eu/949/vehicleTypes/authorisations/> .
@prefix erava-orgroletasks: <http://data.europa.eu/949/concepts/org-role-tasks/> .
@prefix erava-tsi-conforms: <http://data.europa.eu/949/concepts/tsi-conformities/> .
@prefix eravr: <http://data.europa.eu/949/vehicles/registrations/> .
@prefix evr: <http://data.europa.eu/949/vehicles/> .
@prefix foaf: <http://xmlns.com/foaf/0.1/> .
@prefix geo: <http://www.opengis.net/ont/geosparql#> .
@prefix gotham: <https://batman.fandom.com/wiki/> .
@prefix gr: <http://purl.org/goodrelations/v1#> .
@prefix iss: <http://data.europa.eu/949/iss/> .
@prefix iss-dcs: <http://data.europa.eu/949/iss/concepts/document-statuses/> .
@prefix iss-rs: <http://data.europa.eu/949/iss/concepts/record-statuses/> .
@prefix iss-skos: <https://raw.githubusercontent.com/Interoperable-data/ISS_vocabulary/refs/heads/main/iss-skos/> .
@prefix issform: <http://era.europa.eu/forms/iss/> .
@prefix lorg: <http://data.europa.eu/949/organisations/sites/> .
@prefix org: <http://www.w3.org/ns/org#> .
@prefix orgr: <http://data.europa.eu/949/organisations/roles/> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix prov: <http://www.w3.org/ns/prov#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix rorg: <http://data.europa.eu/949/organisations/> .
@prefix schema: <http://schema.org/> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix skos: <http://www.w3.org/2004/02/skos/core#> .
@prefix time: <http://www.w3.org/2006/time#> .
@prefix unit: <http://qudt.org/vocab/unit/> .
@prefix uorg: <http://data.europa.eu/949/organisations/units/> .
@prefix update: <http://data.europa.eu/949/update/> .
@prefix vac: <https://raw.githubusercontent.com/Interoperable-data/automate-va/refs/heads/dev-lws/TTL/> .
@prefix vcard: <http://www.w3.org/2006/vcard/ns#> .
@prefix vpa: <http://w3id.org/vpa#> .
@prefix vs: <http://www.w3.org/2003/06/sw-vocab-status/ns#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .

## Organisations and Sites
rorg:MF-US-GC001-224 a era:Body ; # Wayne Industries, Gotham City, USA (era:Body, see above)
  foaf:name "Wayne Industries" ;
  org:hasSite lorg:MF-US-GC002-225 .

lorg:MF-US-GC002-225 a org:Site ;
  foaf:name "Wayne Industries secret plant" .

rorg:NoBo-US-0001 a era:Body ; # the NoBo and DeBo
  foaf:name "Robin Boy Wonder CA Body" .

rorg:EUAR a era:Body ;
  foaf:name "EU Agency for Railways" .


## OrganisationRoles
orgr:Wayne_Keeper a era:OrganisationRole ; era:roleOf rorg:MF-US-GC001-224 ; era:hasRole era-organisation-roles:Keeper .
orgr:Wayne_Applicant a era:OrganisationRole ; era:roleOf rorg:MF-US-GC001-224 ; era:hasOrganisationRole era-organisation-roles:Applicant .
orgr:Wayne_Manufacturer a era:OrganisationRole ; era:roleOf rorg:MF-US-GC001-224 ;  era:hasOrganisationRole era-organisation-roles:Manufacturer . 
orgr:EUAR_AuthorisingEntity a era:OrganisationRole ; era:roleOf rorg:EUAR ; era:hasOrganisationRole era-organisation-roles:AuthorisingEntity .
orgr:0001_NotifiedBody a era:OrganisationRole ; era:organisationCode "0001" ; era:roleOf rorg:NoBo-US-0001 ; era:hasOrganisationRole era-organisation-roles:NotifiedBody .
orgr:BOWO_DesignatedBody a era:OrganisationRole ; era:organisationCode "BOWO" ; era:roleOf rorg:NoBo-US-0001 ; era:hasOrganisationRole era-organisation-roles:DesignatedBody .


## ERATV
# The VehicleType is in DRAFT and being created.
eratv:vt-71-001-0001-1-001 a era:VehicleType ;
    # TEST I-10-1 SHACL OK: MISSING, LENGTH IS DETECTED
    # FIXED: I-10-1 also threw on era:Vehicle
    dcterms:identifier "71-001-0001-1-001" ;

    # TEST I-10-2: Combination VTNumber and 'included' must be present
    era:vehicleTypeNumber "71-001-0001-1" ; # TEST OK, must be present and exactly 13 characters
    era:includedVersionsVariant "001" ; # TEST I-10-1 SHACL OK: INVALID, both cannot be present
    # era:includedVersions "1OO" ; # TEST I-10-1 & 2 SHACL OK: INVALID, both cannot be present, must be 3 digits

    dcterms:created "2025-07-16"^^xsd:date ;

    # FIXME: dcterms:issued SHALL NOT BE PRESENT, given the type is in DRAFT or the authcase is FIRST, and many parameters are still being filled in.
    dcterms:issued "2025-01-01"^^xsd:date ;
    
    # 10-5 OK: missing label
    rdfs:label "A non-existent self-propelled special vehicle";
    
    # FIXED 10-7-8:
    era:vehicleTypeCategory era-vehicle-types-eratv:51 ; # special vehicles
    
    # FIXED 10-7-8:
    era:vehicleTypeSubCategory era-vehicle-types-eratv:selfPropelledSpecialVehicle ;
    
    # FIXME: MISSING UNDETECTED
    era:vehicleTypeManufacturer orgr:Wayne_Manufacturer ;

    # Configuration (rest of parameters not relevant for testcases)
    era:wheelSetGauge era-ntg-rinf:30 ;
    era:energySupplySystem era-ess-rinf:DC30 ;
    era:vehicleTypePlatform "Batman Rail Vehicles"@en .

eratv:BatmanSpecial a era:VehicleTypeConfiguration ;
    rdfs:label "3kV on US Standard Gauge";
    era:wheelSetGauge era-ntg-rinf:30 ;
    era:energySupplySystem era-ess-rinf:DC30 .

# VR related data
evr:bat-mobile-metro-001 a era:Vehicle ;
    rdfs:label "Wayne Railway Mobile 001-01" ;
    dcterms:identifier "Wayne Railway Mobile 001-01" ;
    era:vehicleKeeper orgr:Wayne_Keeper ;
    era:vehicleType eratv:vt-71-001-0001-1-001 ; # FIXME: this typo should be detected through its authorisation chain.
    # era:hasCompositeBrakeBlockRetrofitted true ;
    # era:operationalRestriction era-noic:2-7-7 ; # it is too loud
    era:manufacturingYear "2023"^^xsd:gYear ;
    era:manufacturingSerialNumber "MV-001-01" ;
    era:vehicleNumber "01234567890-9" ; # should raise several problems
    era:inVehicleSeries evr:vs-batmobiles-001 .

evr:vs-batmobiles-001 a era:VehicleSeries ;
    rdfs:label "Wayne Railway Attack vehicles, series 001"@en ;
    rdfs:member evr:bat-mobile-metro-001 .

evr:vs-batmobiles-002 a era:VehicleSeries ;
    rdfs:label "Wayne Railway Attack vehicles, prototypes"@en ;
    rdfs:member evr:bat-mobile-metro-002 .

evr:bat-mobile-metro-002 a era:Vehicle ;
    dcterms:identifier "Wayne Railway Prototype" ;
    rdfs:label "Wayne Railway Prototype" ;
    # era:vehicleKeeper orgr:Wayne_Keeper ; Keeper CAN pre-reserve the number also
    era:vehicleType eratv:vt-71-001-0001-1-001 ; # FIXME: this typo should be detected through its authorisation chain.
    era:vehicleNumber "09876543210-5" ; # should raise several problems
    era:manufacturingYear "2026"^^xsd:gYear ;
    era:manufacturingSerialNumber "PR-001" ;
    era:inVehicleSeries evr:vs-batmobiles-002 .

eravr:vrapp-71-001-0001-1-001-US-1 a era:VehicleRegistrationApplication ; # subClassOf vpa:Request ;
    rdfs:label "Registration application for series 001 of Vehicle Type 71-001-0001-1-001 in the US"@en ;
    dcterms:creator orgr:Wayne_Applicant ;
    dcterms:audience orgr:EUAR_RegisteringEntity ;
    dcterms:identifier "VRA-20250715-001" ;
    vpa:requestFor eravr:reg-71-001-0001-1-001-US-1 ; # Applicant can only add them when having received the Registration.
    vpa:constitutedBy eravr:vrc-71-001-0001-1-001-US-1 ;
    rdfs:comment "Registering the Batman spacial railway Vehicle to be able to operate it on the Gotham Railway system."@en .

eravr:reg-71-001-0001-1-001-US-1 a era:VehicleRegistration ;
    dcterms:identifier "US/81/2025/0001" ;
    dcterms:issued "2025-01-01"^^xsd:date ;
    dcterms:creator orgr:EUAR_RegisteringEntity ;
    dcterms:audience orgr:Wayne_Keeper ;
    vpa:requestedIn eravr:vrapp-71-001-0001-1-001-US-1 .

eravr:vrc-71-001-0001-1-001-US-1 a era:VehicleRegistrationCase ;
    rdfs:label "Registration case for series 001 of Vehicle Type 71-001-0001-1-001 in the US"@en ;
    vpa:permissionType era-vr-regcase:NEW ;
    vpa:concerns evr:vs-batmobiles-001 .

# Pre-reserved number = no application yet
eravr:vrc-71-001-0001-1-001-US-3 a era:VehicleRegistrationCase ;
    rdfs:label "Registration case for new prototypes of Vehicle Type 71-001-0001-1-001 in the US"@en ;
    vpa:permissionType era-vr-regcase:RESERVE ; # not approved yet
    vpa:concerns evr:vs-batmobiles-002 .

## VA-data
erava:va-71-001-0001-1-001-US-1 a era:VehicleTypeAuthorisationApplication ; # subClassOf vpa:Request ;
    rdfs:label "Authorisation project of the Batman spacial railway Vehicle"@de ;
    
    era:preEngagementBaseline [ a era:PreEngagement ; era:hasPreEngagementBaseline true ; era:preEngagementBaseline "https://example.com/pre-engagement-baseline" ] ; # TEST: I-9 SHACL OK
    # era:preEngagementBaseline [ a era:PreEngagement ; era:hasPreEngagementBaseline true ]; # TEST I-9 SHACL OK: invalid, missing era:preEngagementBaseline
    
    dcterms:creator orgr:Wayne_Applicant ;
    dcterms:audience orgr:EUAR_AuthorisingEntity ;
    dcterms:identifier "VA-20250715-001" ;
    # dcterms:issued "2025-01-01"^^xsd:date ; # UNTESTED
    
    vpa:constitutedBy erava:vac-71-001-0001-1-001-US-1 ;
    vpa:requestFor erava:71-001-0001-1-001-US-1 ; # Applicant can only add them when having received the Authorisation.
    rdfs:comment "To combat terror on the Gotham Railway system, we need the approval to place on the market."@en .

erava:vac-71-001-0001-1-001-US-1 a era:VehicleTypeAuthorisationCase ; # subClassOf vpa:Case
    vpa:permissionType era-va-authcase:NEW ; # TEST I-7 SHACL OK: first authorisation requires absence of dcterms:issued on the type.
    # I-7 holder test ok: invalid with first authorisation, not NEW.
    era:typeRegistrationMethod era-va-trm:NewType ;
    rdfs:label "Case 'NEW' to achieve APOM of type 71-001-0001-1-001 in the US"@en ;
    era:areaOfUse <http://publications.europa.eu/resource/authority/country/DEU> ;
    era:authorisingMemberState <http://publications.europa.eu/resource/authority/country/DEU> ; 
    vpa:concerns eratv:vt-71-001-0001-1-001 , evr:bat-mobile-metro-001 , evr:bat-mobile-metro-002 ;
    vpa:constitutes erava:va-71-001-0001-1-001-US-1 .

erava:71-001-0001-1-001-US-1 a era:VehicleTypeAuthorisation ;
    dcterms:identifier "EU/81/2025/0001" ;
    dcterms:replaces erava:V-20200101-001 ; # I-12: previous authorisation
    # NOT YET dcterms:issued
    # dcterms:issued "2025-01-01"^^xsd:date ; # TEST
    # NOT YET vpa:valid
    # I-7 TEST OK: era:vehicleTypeAuthorisationHolder orgr:Wayne_Manufacturer ;
    vpa:requestedIn erava:va-71-001-0001-1-001-US-1 .

# I-12: previous authorisation
# TODO: process in order to assure these triples exist at the time of issuing the new application?
erava:V-20200101-001 a era:VehicleTypeAuthorisation ;
    dcterms:identifier "EU/81/2020/0786" ;
    dcterms:issued "2020-01-01"^^xsd:date ; # Previous authorisation
    # dcterms:isReplacedBy erava:71-001-0001-1-001-US-1 ; # FIXME: how is this triple written?
    vpa:valid [ a time:ProperInterval ;
      time:hasBeginning "2020-01-01"^^xsd:date ;
      time:hasEnd "2025-01-01"^^xsd:date ] ;
    vpa:requestedIn erava:va-71-001-0001-1-001-US-previous ;
    era:vehicleTypeAuthorisationHolder orgr:Wayne_Manufacturer .

# Previous application/case (minimal sketch)
erava:va-71-001-0001-1-001-US-previous a era:VehicleTypeAuthorisationApplication ;
    vpa:requestFor erava:V-20200101-001 ;
    vpa:constitutedBy erava:vac-71-001-0001-1-001-US-previous .

erava:vac-71-001-0001-1-001-US-previous a era:VehicleTypeAuthorisationCase ;
    vpa:permissionType era-va-authcase:FA ;           # or EXT, etc.
    vpa:concerns eratv:vt-71-001-0001-1-001 .

# VA-Library
gotham:debo-71-001-0001-1-001-US a era:CABEvidence ;
    rdfs:label "DeBo checks on the Gotham City local rules";
    rdfs:member gotham:debo-123 , gotham:debo-456 ;
    vpa:statesCompliance [ a vpa:Compliance ;
      vpa:compliant "true"^^xsd:boolean ;
      vpa:checkedSection "2.1.1 Strength and integrity" , "3.1 Vehicle gauge" , "3.2.1 Running safety and dynamics", "3.3.5 Sanding system" , "3.3.7 Axle shaft", "4.1 Functional requirements for braking at train level" , "4.5 Brake performance" , "12.1.2.2 Other GSM-R requirements", "12.2.1 National on-board signalling systems" ;
      vpa:withRestriction [
        a era:VehicleTypeAuthorisationRestriction ; # subClassOf vpa:Restriction ;
        era:forConfiguration eratv:BatmanSpecial  ;
        era:nonCodedRestrictions "Should not be exposed to extra-terrestrial blast weapons"@en
      ]
    ] ;	
    vpa:supportsCase erava:vac-71-001-0001-1-001-US-1 .

gotham:nobo-71-001-0001-1-001-US a era:CABEvidence ;
  rdfs:label "NoBo covered declarations";
  rdfs:member era-ecd:ecd-123 ;
  vpa:statesCompliance [ a vpa:Compliance ;
    vpa:compliant "false"^^xsd:boolean ;
    vpa:checkedRequirement eralex:reg-2013-1236 , eralex:reg-2014-1304 , eralex:reg-2015-924 , eralex:reg-2013-321  ;
    vpa:withRestriction [
      a era:VehicleTypeAuthorisationRestriction ; # subClassOf vpa:Restriction ;
      era:forConfiguration eratv:BatmanSpecial  ;
      era:nonCodedRestrictions "Not allowed on EU Railways, only to be used in Gotham metro."@en
    ]
  ] ;	
  vpa:supportsCase erava:vac-71-001-0001-1-001-US-1 .


## ERADIS
# always pre-insert prefixes.ttl
## DEV: ERADIS-data graph MUST IN PRODUCTION be retrieved from ERADIS+

gotham:debo-123 a era:ECCertificate ;
    dcterms:identifier "US001/1/NNTR/2025/RST/EN/WAYNE-001/V01" ;
    dcterms:type era-cld-types:1 ;
    # dcterms:issued "2025-01-01"^^xsd:date ; # UNDETECTED MISSING
    dcterms:source eralex:dir-2016-797 ; # the EU Legislation, as applied in Gotham
    dcterms:creator orgr:BOWO_DesignatedBody ;
    rdfs:label "NNTR verification certificate - underbody, wheelsets, axles, wheels" ;
    vpa:valid [
      a time:ProperInterval ;
      time:hasBeginning "2024-04-01"^^xsd:date ; #start of validity
      time:hasDurationDescription [
          # https://www.w3.org/TR/owl-time/#time:DurationDescription
          time:years 10 ;
      ]
    ].

gotham:debo-456 a era:ECCertificate ;
    dcterms:identifier "US001/1/NNTR/2025/RST/EN/WAYNE-002/V01" ;
    dcterms:type era-cld-types:1 ;
    # dcterms:issued "2025-01-01"^^xsd:date ; # UNDETECTED MISSING
    dcterms:source eralex:dir-2016-797 ; # the EU Legislation, as applied in Gotham
    dcterms:creator orgr:BOWO_DesignatedBody ;
    rdfs:label "NNTR verification certificate - plating, weapons and structure" ;
    vpa:valid [
      a time:ProperInterval ;
      time:hasBeginning "2019-04-01"^^xsd:date ; #start of validity
      time:hasDurationDescription [
          # https://www.w3.org/TR/owl-time/#time:DurationDescription
          time:years 5 ; # example of an expired one.
      ]
    ].

era-ecd:ecd-123 a era:ECDeclaration ;
    dcterms:type era-ecd-types:ECDoV ;
    dcterms:identifier "US/000000GC93653a/2022/000014" ;
    dcterms:label "DoV for Wayne Industries special railway attack vehicle";
    dcterms:creator orgr:Wayne_Applicant;
    dcterms:requires [ a era:CABEvidence ; rdfs:member era-cld:cld-NoBoCert-123000 , era-cld:cld-NoBoCert-456000 ];
    dcterms:issued "2022-04-03"^^xsd:date ;
    vpa:versionNumber 1 .

era-cld:cld-NoBoCert-123000 a era:CLD ;
    dcterms:identifier "0001/1/SB/2022/RST/EN/WAYN0001/01" ;
    dcterms:type era-cld-types:1 ;
    dcterms:source eralex:dir-2016-797 ; # the EU Legislation, as applied in Gotham
    rdfs:label "TSI RST TE verification certificate" ;
    dcterms:audience orgr:Wayne_Applicant;
    dcterms:creator orgr:0001_NotifiedBody ;
    vpa:checkedCompliance [ a era:CABAssessmentCheck ; vpa:checkedRequirement eralex:reg-2014-1304 ; vpa:isCompliant false ; vpa:withRestriction gotham:clui-123 ] ;
    vpa:valid [
      a time:ProperInterval ;
      time:hasBeginning "2022-04-02"^^xsd:date ; #start of validity
      time:hasDurationDescription [
          # https://www.w3.org/TR/owl-time/#time:DurationDescription
          time:years 10 ;
      ]
    ].

gotham:clui-123 a era:CABRestriction ; # subClassOf era:Restriction
    vpa:regarding eralex:reg-2014-1304 ;
    era:nonCodedRestrictions "The vehicle has a non-compliant mass per wheel"@en .
  
era-cld:cld-NoBoCert-456000 a era:CLD ;
    dcterms:identifier "0001/4/SD/2022/RST/EN/WAYN0001/01" ;
    dcterms:type era-cld-types:4 ;
    dcterms:source eralex:dir-2016-797 ; # the EU Legislation, as applied in Gotham
    dcterms:spatial lorg:MF-DE-GC002-225 ; # restricted to the audit at production site.
    rdfs:label "TSI RST QMSA verification certificate - secret site" ;
    dcterms:audience orgr:Wayne_Applicant;
    dcterms:creator orgr:0001_NotifiedBody ;
    vpa:checkedCompliance [ a era:CABAuditCheck ; vpa:checkedRequirement eralex:reg-2014-1304 ; vpa:isCompliant false ; vpa:withRestriction gotham:clui-456 ] ;
    vpa:valid [
        a time:ProperInterval ;
        time:hasBeginning "2022-04-01"^^xsd:date ; #start of validity
        time:hasDurationDescription [
            # https://www.w3.org/TR/owl-time/#time:DurationDescription
            time:years 2 ; # example of an expired CLD, which should cause the ECD to be declared expired.
        ]
    ].

gotham:clui-456 a era:CABRestriction ; # subClassOf era:Restriction
    vpa:regarding eralex:reg-2014-1304 ;
    era:nonCodedRestrictions "The audit could not take place as access to the secret construction site was not allowed."@en .


